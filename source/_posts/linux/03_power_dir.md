---
title: Linux 学习笔记_03 - 文件权限与目录配置
date: 2018-06-14 00:35:21
tags: [Linux]
category: 'linux'
---

[fhs_url]: http://www.pathname.com/fhs/

### 用户与用户组

Linux 中任何一个文件，都有”User，Group，Others“三种身份的个别权限。

默认情况下：

1.  所有系统上帐号与一般用户，root 相关信息，都记录在`/etc/passwd`
2.  个人的密码记录在`/etc/shadow`
3.  所有组名都记录在`/etc/group`

### 文件权限概念

#### 文件属性

查看文件夹内文件权限：

    [user@www ~]$ ls -al

其中一条输出为例：

    -rw-r--r--   1    root    root     4275     3月  10 17:29  .bashrc
     [文件权限] [连接] [所有者] [用户组] [文件容量]    [修改日期]    [文件名]

第 1 部分共有 10 个字符，代表文件的类型与权限。

##### 文件类型与权限

第 1 个字符代表文件类型：

- [d]，是目录
- [-]，是文件
- [l]，连接文件（linkfile）
- [b]，设备文件里面的可供存储的接口设备
- [c]，设备文件里边的串行端口设备，如鼠标、键盘（一次性读取设备）

第 2 ～ 4 个字符，**文件所有者权限**，是”rwx“的组合，对应可读（read）、可写（write）、可执行（execute），有权限显示字符，无权限显示[-]。

第 5 ～ 7 个字符，**同用户组的权限**，是”rwx“组合，同上。

第 8 ～ 10 个字符，**其他非本用户组的权限**，是”rwx“组合，同上。

##### 其他部分

第 2 列表示多少个文件名连接到此节点（i-node）。

第 3 列表示这个文件或目录的所有者帐号。

第 4 列表示这个文件的所属用户组。

第 5 列为这个文件容量，默认单位是 B。

第 6 列问这个文件的创建日期或最近修改日期，`ls -l --full-time`命令可以显示完整时间。

第 7 列为该文件名，以”.“开头表示是**隐藏文件**。

#### 改变文件权限与属性

##### 改变所属用户组：chgrp（change group）

改变的组名必须在`/etc/group`中存在才行。

    [user@www ~]$ chgrp [-R] 用户组名 文件或目录

参数：
-R：修改文件夹及其子目录。

例（假设系统中已经存在 user 用户名和 group 用户组，使用 root 帐号操作）：

    [root@www ~]$ ls -al test.log
    -rw-r--r-- 1 user group 63 6月  23 11:05 test.log
    [root@www ~]# chgrp root test.log
    [root@www ~]# ls -al test.log
    -rw-r--r-- 1 user root 63 6月  23 11:05 test.log

##### 改变文件所有者：chown（change owner）

用户必须是系统中已经存在的用户，也就是在`/etc/passwd`中存在的用户。

    [user@www ~]$ chown [-R] 帐号名:组名 文件或目录

参数：
-R：修改文件夹及其子目录。

chown 也可以使用“帐号名.组名”，但是由于帐号名中可能含有“.”造成系统误判，推荐使用“:”。

例（假设系统中已经存在 user 用户名和 group 用户组，使用 root 帐号操作）：

    [root@www ~]# ls -al test.log
    -rw-r--r-- 1 user user 63 6月  23 11:05 test.log
    [root@www ~]# chown root test.log
    [root@www ~]# ls -al test.log
    -rw-r--r-- 1 root user 63 6月  23 11:05 test.log

##### 改变文件权限：chmod

Linux 的基本权限有 9 个，分别是 owner，group，others 及其分别对应的 read，write，execute，文件权限对应的权限字符“-rwxrwxrwx”，三个一组代表各自权限。

1.  可以使用数字来代表各自权限，数字表：

- r：4
- w：2
- x：1

所以需哟拥有所有权限的话就是“777”。

    [user@www ~]$ chmod [-R] xyz 文件或目录

参数：
-R：修改文件夹及其子目录。

例：

    [user@www ~]$ ls -al test.log
    -rw-r--r-- 1 user user 63 6月  23 11:05 test.log
    [user@www ~]$ chmod 770 test.log
    [user@www ~]$ ls -al test.log
    -rwxrwx--- 1 user user 63 6月  23 11:05 test.log
    [user@www ~]$ chmod 744 test.log
    [user@www ~]$ ls -al test.log
    -rwxr--r-- 1 user user 63 6月  23 11:05 test.log
    [user@www ~]$ chmod 644 test.log
    [user@www ~]$ ls -al test.log
    -rw-r--r-- 1 user user 63 6月  23 11:05 test.log

2.  符号类型改变文件权限：

    chmod [u|g|o|a][+|-|=][r|w|x] 文件或目录

参数：
u、g、o、a：分别对应 user、group、others、all（所有权限） +、-、=：分别对应加入、去除、设置某种或某些权限。

例：

    [user@www ~]$ ls -al test.log
    -rw-r--r-- 1 user user 63 6 月 23 11:05 test.log
    [user@www ~]$ chmod u=rwx,g=rwx,o-r test.log
    [user@www ~]$ ls -al test.log
    -rwxrwx--- 1 user user 63 6 月 23 11:05 test.log
    [user@www ~]$ chmod u-x,g-wx,o+r test.log
    [user@www ~]$ ls -al test.log
    -rw-r--r-- 1 user user 63 6 月 23 11:05 test.log
    [user@www ~]$ chmod a+w test.log
    [user@www ~]$ ls -al test.log
    -rw-rw-rw- 1 user user 63 6 月 23 11:05 test.log
    [user@www ~]$ chmod g-w,o-w test.log
    [user@www ~]$ ls -al test.log
    -rw-r--r-- 1 user user 63 6 月 23 11:05 test.log

#### 目录与文件权限的意义

Linux 文件或目录都有 9 中基本权限。

##### 文件的权限

- r：读取文件内容
- w：编辑文件内容（可以删除文件内容，但是不能删除文件）
- x：可以执行文件，Linux 是否可执行，与后缀名无关，有可执行权限不一定可执行（需要看文件内容是否为可执行内容），没有该权限，一定不能执行。

##### 目录的权限

- r：有可以读取目录结构权限，也就是 ls 命令可以该目录下运行
- w：表示拥有可以修改该目录结构目录表的权限，也就是与该目录下文件或目录的名字变动相关
  - 新建新的文件或目录
  - 删除已存在文件或目录（与被删除文件或目录权限无关）
  - 将已存在文件或目录重命名
  - 移动文件或目录
- x：用户是否能进入该目录成为工作目录
  - 没有该权限就不能切换到该目录下，也就无法执行该目录的任何命令，即使拥有 r 权限
  - 如果想把某目录开放给其他用户可读，至少拥有 rx 权限

#### 文件种类与扩展名

##### 文件种类

- 普通文件（regular file）：文件属性[-]

  - 纯文本文件（ASCII）：系统中最多文件类型，文件内容可以直接读取
  - 二进制文件（binary）：系统仅认识且可执行二进制文件
  - 数据文件（data）：某些程序读取的特殊格式的文件

- 目录（directory）：文件属性[d]

- 连接文件（link）：文件属性[l]
  类似 windows 下快捷方式。

- 设备与设备文件（device）
  与系统外设及存储相关文件，通常集中在/dev 目录。

  - 块（block）设备文件：文件属性[b]
    提供系统随机访问的接口设备的存储数据。

  - 字符（character）设备文件：文件属性[c]
    一些串行端口的接口设备。

- 套接字（sockets）：文件属性[s]
  数据接口文件，通常被用在网络上的数据连接，通常在/var/run 这个目录可以看到这个类型文件。

- 管道（FIFO，pipe）：文件属性[p]
  特殊文件类型，和进程相关，目的在于解决多个程序同时访问一个文件所造成的错误问题。

##### 文件扩展名

一个 Linux 文件能不能被执行，与他第一列的 10 个属性相关，与文件名根本没有一点关系。只要权限当中具有 x，即代表文件可以被执行。但是我们仍希望使用适当的扩展名来了解该文件什么意思。

- \*.sh：批处理文件或脚本，由于批处理文件使用 shell 写的，所以以此后缀。

- \*Z、\*.tar、\*.tar.gz、\*.zip、\*.tgz：压缩文件。

- \*.html、\*.php：网页相关文件。

##### 文件长度限制

系统使用 Ext2/Ext3 文件系统时，文件名有限制：

- 单一文件或目录的最大容许文件名为 255 个字符。

- 包含完整路径及目录（/）的完整文件名为 4096 个字符。

##### 文件名限制

由于 Linux 命令操作的关系，文件名最好避免一些字符：

    * ? > < ; & ! [ ] | \ ' " ` ( ) { }

由于“.”开头的是隐藏文件，命令中参数经常使用“-”、“+”，所以做好避免使用这些字符作为文件名开头字符。

### 目录配置

每种 Linux 发行版的目录结构都差不多是因为有一套目录结构标准。

#### 目录配置标准：FHS

[FHS][fhs_url]（Filesystem Hierarchy Standard）标准的目的是希望让所有用户可以了解到以安装软件通常放置于哪个目录下。

FHS 一直在根据经验来改版，依据文件使用频繁与否，是否允许用户随意改动，将目录定位为四种交互作用的形态：

|                      | 可分享的（shareable）     | 不可分享的（unshareable） |
| -------------------- | ------------------------- | ------------------------- |
| 不变的（static）     | /usr（软件放置处）        | /etc （配置文件）         |
| \_                   | /opt（第三方软件）        | /boot （开机与内核文件）  |
| 可变动的（variable） | /var/mail（用户邮件信箱） | /var/run（程序相关）      |
| \_                   | /var/spool/news（新闻组） | /var/lock（程序相关）     |

- 可分享的：可以分享给其他系统挂载使用的目录。
- 不可分享的：自己机器上运行的设备文件或者与程序相关的 socket 文件。
- 不变的：这些数据不经常变动，跟随着 distribution 而不变动。
- 可变的：经常改变的数据。

##### 目录结构

FHS 针对目录定义的标准：

- /（root，根目录）：与开机系统相关。

  根目录是系统最重要的目录，不但因为所有目录都是由其衍生，还因为它与开机、还原、系统修复等操作相关。

  FHS 建议：根目录所在分区越小越好，且应用程序所安装软件最好不要与根目录放在同一个分区内，保持根目录越小越好，不但性能好，而且比较不容易发生问题。

- /usr（UNIX software resource）：与软件安装执行相关。

  FHS 建议软件开发者，应该将他们的数据合理的放置到这个目录下的不同子目录下，而不要自己新建该软件自己的独立目录。

  所有 distribution 软件都在该目录下，类系与 Windows 的“C:\Windows\”和“C:\Program files”。

  子目录建议：

  - /usr/X11R6/：X Window 系统重要数据，X 的 11 版第 6 次释出。
  - /usr/bin/：绝大部分用户可使用的命令在这里。
  - /usr/include/：C/C++等程序语言的头文件与包含文件放置处。
  - /usr/lib/：包含各应用软件的函数库、目标文件，以及不被一般用户惯用的执行文件或脚本。
  - /usr/local/：系统管理员在本机自行安装的自己下载的软件建议安装到此目录。
  - /usr/sbin/：非系统正常运行所需要的系统命令。
  - /usr/share/：放置共享文件，基本都是文本文件。
  - /usr/src/：一般源码建议放置到此处。内核源码建议放置到/usr/src/linux 目录。

- /var（variable）：与系统运行过程有关。

  主要针对常态变动文件，包括缓存、登录文件、以及软件运行产生的文件。

  常见子目录：

  - /var/cache/：应用程序运行产生的暂存文件。
  - /var/lib/：应用运行过程中所使用的数据文件，各自软件有各自的目录。
  - /var/lock/：某些设备或资源以此只能被一个应用程序使用，因此该设备上锁，确保以此只有一个程序使用。
  - /var/log/：登录文件放置目录。
  - /var/mail/：个人邮件信箱目录，也常放置于/var/spool/mail/中，通常这俩互为连接文件。
  - /var/run/：某些程序或服务启动后，他们的 PID 放置该目录。
  - /var/spool/：通常放置队列数据，就是排队等待其他程序使用的数据，使用后通常被删除。

- **/bin**：重要执行文件。放置在单用户维护模式下还能够被操作的命令，该目录下命令可以被 root 和一般帐号使用。

- /boot：放置开机会使用到的文件。Linux kernel 常用文件名为 vmlinuz，如果使用 grub 引导，还会存在/boot/grub/这个目录。

- **/dev**：任何设备与接口设备都是以文件形式存在于该目录。

- **/etc**：系统主要的配置文件存在与该目录，一般允许一般帐号查阅，但是只有 root 帐号可修改。FHS 建议不要放置可执行文件在该目录内。

  - /etc/init.d/：所有服务的默认启动脚本放在这里。
  - /etc/xinetd.d/：super daemon 管理的各项服务的配置文件目录。
  - /etc/X11/：与 X Window 有关的各项配置文件都在这里。

- /home：系统默认的用户主文件夹（home directory）。

  - ～：当前用户的主文件夹。

- **/lib**：执行文件所需要的函数库与内核所需要的模块。放置开机时会用到的函数库，以及在/bin 和/sbin 目录下命令会调用的函数库而已。

- /media：放置的可删除的设备。

- /mnt：暂时挂载某些额外设备。

- /opt：第三方软件放置目录。自己安装的软件（非 distribution 提供软件），也可以放在这里，之前也曾习惯放在/usr/local 文件夹。

- /root：系统管理员（root）的主文件夹。我们会希望该目录和根目录放到同一分区。

- **/sbin**：重要的系统执行文件。开机过程所需要的设置系统环境命令，包括开机、修复、还原系统所需要的命令。

  - /usr/sbin：某些服务器软件程序。
  - /usr/local/sbin：本机自行安装软件所产生的系统执行文件。

- /srv：可视为 service 的缩写，是一些网络服务启动后，这些服务所需要取用的数据目录。

- /tmp：让一般用户或者正在执行的程序暂时存放文件的地方。不可放置重要数据，FHS 建议开机清空此目录。

其中高亮部分是 5 个重要的目录，千万不能和根目录放在不同的分区。

还有一些其他重要的目录需要了解：

- /lost+found：使用标准的 ext2/ext3 系统格式才会出现目录，目的是将系统发生错误时，将一些错误片段丢到该文件夹。通常在分区顶层。如加硬盘与/disk，则自动产生/disk/lost+found。

- /proc：目录本身是一个虚拟文件系统，它放置的数据都是在内存当中的，本身不占硬盘空间。

- /sys：与/proc 相似，虚拟文件系统，主要也记录与内核相关信息，不占硬盘。

#### 目录树

- 每个目录的其实点为根目录（/，root）。

- 每一个目录不仅使用本地端的文件系统，还可以使用网络端的文件系统。

- 每个文件的文件名（包含完整路径）在系统里是独一无二的。

- 绝对路径、相对路径不详述。
